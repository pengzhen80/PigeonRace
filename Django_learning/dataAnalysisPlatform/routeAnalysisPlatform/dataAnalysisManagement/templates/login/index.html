<!DOCTYPE html>
<html>
{% load static %}

<head>
    <!-- <meta charset="utf-8"> -->
    <title>活動頁面</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="{% static 'css/table.css' %}" />>
    <style>
        body {
            background-color: #080710;
        }
        .input {
            background-color: white;
            border: none;
            color: black;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            position: relative;
        }


        .button {
            background-color: #FFED86;
            border: none;
            color: black;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            position: relative;
        }
    </style>
</head>

<body>
    <!-- <input type="text" id="textInput_activityPage_pigeonNumber" placeholder=公環號碼 class="input">
    <button id="btn_activityPage_searchRoutesByPigeonNumber" class="button">搜索放飛列表</button>
    <br><br> -->
    <button id="btn_activityPage_acitivity_detail" class="button">查看詳情</button>
    <br><br>
    <table id="table_activityPage_activity">
        <thead>
            <tr>
                <th></th>
                <th>活動名稱</th>
                <th>放飛日期</th>
                <th>飛行時間</th>
            </tr>
        </thead>
        <tbody id="table_activityPage_activity_body">
            <!-- <tr>
                <td>null</td>
                <td>null</td>
                <td>null</td>

            </tr> -->
        </tbody>
    </table>
    <!-- <script type="module" src="{% static 'js/activity.js' %}"></script> -->
    <script>
        let status = '{{ status|safe }}';
        let activities = '{{ activities|safe }}';
        console.log('status:', status);
        let normalized_activities = JSON.parse(activities)
        console.log('activities:', typeof (normalized_activities), normalized_activities.length);

        // activity_showInTable(normalized_activities);
        // activity_showInTable(normalized_activities);
        activity_showInTable(normalized_activities);
        function activity_showInTable(param_activities) {
            let table_activityPage_activity_body = document.getElementById('table_activityPage_activity_body');
            for (var i = 0; i < param_activities.length; i++) {
                func_table_activity_addData(param_activities[i]['activity_name'], param_activities[i]['release_date'], param_activities[i]['release_time']);
            }
            function func_table_activity_addData(name, release_date, release_time) {
                var row = document.createElement('tr');
                var row_data_0 = document.createElement("INPUT");
                row_data_0.setAttribute("type", "checkbox");
                // row_data_0.style.position = 'absolute';
                // row_data_0.style.top = '30%';
                var row_data_1 = document.createElement('td');
                row_data_1.innerHTML = name;
                // row_data_1.style.textAlign = "center";
                var row_data_2 = document.createElement('td');
                row_data_2.innerHTML = release_date.split('T')[0];
                // row_data_2.style.textAlign = "center";
                var row_data_3 = document.createElement('td');
                row_data_3.innerHTML = release_time;
                // row_data_3.style.textAlign = "center";

                row.appendChild(row_data_0);
                row.appendChild(row_data_1);
                row.appendChild(row_data_2);
                row.appendChild(row_data_3);
                table_activityPage_activity_body.appendChild(row);
            }
        }

        function func_cb_btn_activityPage_acitivity_detail() {
            //get selected index of table
            var index_checked = [];
            var rows = document.getElementById("table_activityPage_activity_body").rows;
            console.log(rows);
            for (var i = 0; i < rows.length; i++) {
                console.log(rows[i]);
                var checkbox = rows[i].getElementsByTagName("input")[0];
                // console.log(checkbox);
                console.log(checkbox.checked);
                if(checkbox.checked == true)
                {
                    index_checked.push(i);
                }
            }
            console.log(index_checked);
            
            var activity_checked_list = [];
            for(i =0;i<index_checked.length;i++)
            {
                activity_checked_list.push(normalized_activities[index_checked[i]]['activity_id']);
            }

            window.open('login/tracks/'+activity_checked_list.toString());
            // window.open('login/tracks/'+activity_checked_list.toString(),name='view_tracks');
        }
        let btn_activityPage_acitivity_detail = document.getElementById('btn_activityPage_acitivity_detail');
        btn_activityPage_acitivity_detail.addEventListener('click',func_cb_btn_activityPage_acitivity_detail);
    </script>
</body>