<!DOCTYPE html>
<html>
{% load static %}

<head>
    <!-- <meta charset="utf-8"> -->
    <title>創建鴿子</title>
    <!-- for header -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <!-- <link rel="stylesheet" href="{% static 'css/table.css' %}" /> -->
    <!-- css for header -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'css/templatemo-space-dynamic.css' %}">
    <!-- for ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        .myDiv_chart {
            width: 100%;
            height: 40%;
        }
        .myDiv_pigeonImformationCollect {
            /* text-align: center; */
            width:100%;
            height: 400px;
            top : 100px;
            position: relative;
        }
        .myPersonInterduction_container{
            background-color: white;
            top : 100px;
            position: relative;
            /* height: 400px; */
        }
        .myPersonInterduction_image
        {
            max-width:50%;
            max-height:100%;
        }
        .button_newPigeon
        {
            left :200px;
            top : 100px;
            position: relative;
        }
    </style>
</head>
<!-- <header class="header-area header-sticky wow slideInDown animated background-header" data-wow-duration="0.75s"
    data-wow-delay="0s"
    style="visibility: visible;-webkit-animation-duration: 0.75s; -moz-animation-duration: 0.75s; animation-duration: 0.75s;-webkit-animation-delay: 0s; -moz-animation-delay: 0s; animation-delay: 0s;">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <a href="../login" class="logo">
                        <h4>Sky<span>Leader</span></h4>
                    </a>
                    <ul class="nav">
                        <li class="scroll-to-section"><a href="../login" class="">Home</a></li>
                        <li class="scroll-to-section"><a href="activity" class="">Activity</a></li>
                        <li class="scroll-to-section"><a href="#pigeon" class="active">Pigeon</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</header> -->
<body>
<div class="container myDiv_pigeonImformationCollect">
    <div class="row">
        <div class="col-sm"> upload image
            <div class="input-group mb-3">
                <!-- <div class="input-group-prepend">
                    <span class="input-group-text">Upload</span>
                </div> -->
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="pigeonImageUploader" accept=".jpg, .png, .jpeg, .gif, .bmp, .tif, .tiff|image/*" onchange="showImageFile(event)">
                    <!-- <label class="custom-file-label" for="inputGroupFile01">Choose file</label> -->
                </div>
            </div>
            <img id='showPigeonImage' src="{% static 'images/652206.png' %}" class="img-fluid" alt="Responsive image">
            <br></br>
            <!-- <button id='button_uploadPigeonImage' type="button" class="btn btn-primary">上傳</button> -->
        </div>
        <div class="col-sm"> input imformation
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text">公環號碼</span>
                </div>
                <input type="text" class="form-control" placeholder="公環號碼" aria-label="公環號碼"
                    aria-describedby="basic-addon1"  id="pigeon_create_pigeonNumber">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" >性別</span>
                </div>
                <input type="text" class="form-control" placeholder="性別" aria-label="性別"
                    aria-describedby="basic-addon1" id="pigeon_create_sex">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" >鴿齡</span>
                </div>
                <input type="text" class="form-control" placeholder="鴿齡" aria-label="鴿齡"
                    aria-describedby="basic-addon1" id="pigeon_create_age">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" >重量</span>
                </div>
                <input type="text" class="form-control" placeholder="重量" aria-label="重量"
                    aria-describedby="basic-addon1" id="pigeon_create_weight">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text">身長</span>
                </div>
                <input type="text" class="form-control" placeholder="身長" aria-label="身長"
                    aria-describedby="basic-addon1" id="pigeon_create_bodyLength">
            </div>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" >翅膀長度</span>
                </div>
                <input type="text" class="form-control" placeholder="翅膀長度" aria-label="翅膀長度"
                    aria-describedby="basic-addon1" id="pigeon_create_wingLength">
            </div>
            <button id='button_createPigeon' type="button" class="btn btn-primary" onclick="update_pigeonInfo()">更新鴿子</button>
        </div>
    </div>
</div>
<script>

    let pigeonData = '{{ pigeonData|safe }}';
    let normalize_pigeonData = JSON.parse(pigeonData)
    console.log(normalize_pigeonData);

    show_pigeonInfo(normalize_pigeonData);
    function show_pigeonInfo(pigeonInfos)
    {
        // var image = document.getElementById('showPigeonImage').src;
        var pigeonNumber = document.getElementById('pigeon_create_pigeonNumber');
        var pigeonSex = document.getElementById('pigeon_create_sex');
        var pigeonAge = document.getElementById('pigeon_create_age');
        var pigeonWeight = document.getElementById('pigeon_create_weight');
        var pigeonBodyLength = document.getElementById('pigeon_create_bodyLength');
        var pigeonWingLength = document.getElementById('pigeon_create_wingLength');
        pigeonNumber.value = pigeonInfos[2];
        pigeonSex.value = pigeonInfos[7];
        pigeonAge.value = pigeonInfos[8];
        pigeonWeight.value = pigeonInfos[11];
        pigeonBodyLength.value = pigeonInfos[9];
        pigeonWingLength.value = pigeonInfos[10];
    }

    function update_pigeonInfo()
    {
        var pigeonInfos  = normalize_pigeonData;
        var pigeonNumber = document.getElementById('pigeon_create_pigeonNumber').value;
        var pigeonSex = document.getElementById('pigeon_create_sex').value;
        var pigeonAge = document.getElementById('pigeon_create_age').value;
        var pigeonWeight = document.getElementById('pigeon_create_weight').value;
        var pigeonBodyLength = document.getElementById('pigeon_create_bodyLength').value;
        var pigeonWingLength = document.getElementById('pigeon_create_wingLength').value;
        function reqListener() {
                var response = JSON.parse(this.responseText);
                console.log(response);
        }

        if((pigeonNumber!=pigeonInfos[2])||(pigeonSex!=pigeonInfos[7])||(pigeonAge!=pigeonInfos[8])||(pigeonWeight!=pigeonInfos[11])||(pigeonBodyLength!=pigeonInfos[9])||(pigeonWingLength != pigeonInfos[10]))
        {
            var make_send = {};
            make_send['option'] = 'update';
            make_send['doveName'] = pigeonNumber;
            make_send['sex'] = pigeonSex;
            make_send['age'] = pigeonAge;
            make_send['weight'] = pigeonWeight;
            make_send['bodyLength'] = pigeonBodyLength;
            make_send['wingLength'] = pigeonWingLength;
            console.log(make_send);

            var oReq = new XMLHttpRequest();
            oReq.addEventListener("load", reqListener);
            oReq.open("post", pigeonInfos[0]);
            oReq.setRequestHeader("X-CSRFToken", '{{ csrf_token|safe }}');
                // oReq.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");   
            oReq.send(JSON.stringify(make_send));
        }
        else
        {
            alert('no changes to update');
        }
    }

    var showImageFile = function(event) {
                var image = document.getElementById('showPigeonImage');
                image.src = URL.createObjectURL(event.target.files[0]);
    };
</script>
</body>